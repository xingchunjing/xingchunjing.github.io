<p style="line-height: 2;"><span style="font-size: 19px; font-family: 华文楷体;">google支付需要在服务端记录并验证订单，防止伪造订单，这里记录一下服务端校验订单</span></p><p style="line-height: 2;"><span style="font-size: 16px; font-family: 华文楷体;">Google Pay主要支付流程</span></p><ul><li style="line-height: 2;"><span style="font-size: 16px; font-family: 华文楷体;">手机端向Java服务端发起支付，生成预订单，给手机端返回生成的订单号</span></li><li style="line-height: 2;"><span style="font-size: 16px; font-family: 华文楷体;">手机端向Google发起支付（传入java服务端生成的订单号）</span></li><li style="line-height: 2;"><span style="font-size: 16px; font-family: 华文楷体;">Google服务器将支付结果返回给手机端（因这边用到的是消耗型的产品，所以购买后必须要通知gp我已经消耗了这次交易）</span></li><li style="line-height: 2;"><span style="font-size: 16px; font-family: 华文楷体;">手机端向Java服务端发送校验请求，校验通过后即可处理订单（服务端重试校验，发货，保证订单正常发货成功）</span></li></ul><p style="line-height: 2;"><span style="color: rgb(66, 144, 247); font-size: 16px; font-family: 华文楷体;">一. 创建服务账号</span></p><ul><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">打开地址： </span><a href="https://console.cloud.google.com" target="_blank"><span style="font-size: 14px; font-family: 华文楷体;">https://console.cloud.google.com</span></a></li><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">选择项目或者创建一个新的项目，为了区分和维护推荐创建个新的项目</span></li><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">选中项目后例如(Google-Pay) 创建服务帐户</span></li><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">在“ 服务帐户详细信息”下 ，键入服务帐户的名称，ID和描述，然后单击“ 创建”</span></li><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">可选：在“ 服务帐户权限”下 ，选择要授予服务帐户的IAM角色，然后单击继续</span></li><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">可选：在“ 授予用户对此服务帐户的访问权限”下 ，添加允许使用和管理该服务帐户的用户或组。</span></li><li style="line-height: 2;"><span style="color: rgb(225, 60, 57); font-size: 14px; font-family: 华文楷体;">单击管理密钥，创建密钥 ，然后单击创建推荐生成json格式密钥。(备用，后面代码会用到)</span></li></ul><p style="line-height: 2;"><img src="/article/java-google01.jpg" alt="" data-href="/article/java-google01.jpg" style=""></p><p style="line-height: 2;"><span style="color: rgb(66, 144, 247); font-size: 16px; font-family: 华文楷体;">二.Google Play后台关联服务账号并授权（owner权限）</span></p><ul><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">进入Google Play 管理中心的API 权限页面</span></li><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">将 Google Play 开发者帐号关联到 Google Cloud 项目如（Google-Pay）</span></li><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">点击服务帐号下要向自己的服务帐号授予对 Cloud 项目的访问权限，这样它才能显示在Google Play管理后台</span></li><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">完成点击刷新，API 权限页面的“服务帐号”会自动刷新，您的服务帐号将随即列出。</span></li><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">点击授予api访问权和应用于哪个app(可以选择多个app)，为服务帐号提供相关操作所需的权限。</span></li></ul><p style="line-height: 2;"><span style="color: rgb(225, 60, 57); font-size: 14px; font-family: 华文楷体;">注意：</span></p><p style="text-indent: 2em; line-height: 2;"><span style="color: rgb(225, 60, 57); font-size: 14px; font-family: 华文楷体;">必须先将 Google Play 开发者帐号关联到 Google Cloud 项目，然后才能访问 Google Play Developer API。在大多数情况下，我们建议您为自己的 Google Play 开发者帐号新建一个专用的 Google Cloud 项目，不过您也可以关联现有项目。请注意，每个 Google Play 开发者帐号只能关联到一个 Google Cloud 项目。如果您的同一个 Google Play 开发者帐号中有多个应用，这些应用必须都共用同一个 Google Cloud 项目。</span></p><p style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">以上参考： </span><a href="https://blog.csdn.net/weixin_39222112/article/details/120068129 " target="_blank"><span style="font-size: 14px; font-family: 华文楷体;">https://blog.csdn.net/weixin_39222112/article/details/120068129 </span></a></p><p style="line-height: 2;"><span style="color: rgb(66, 144, 247); font-size: 16px; font-family: 华文楷体;">三. 获取凭证</span></p><p style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">由于要链接Google Play</span><span style="color: rgb(68, 68, 68); font-size: 14px; font-family: 华文楷体;"> 中的项目所以直接导入</span><span style="color: rgb(185, 74, 72); font-size: 14px; font-family: 华文楷体;">androidpublisher，这里已经包含了鉴权相关的api，不用重复倒入依赖包</span></p><pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;com.google.apis&lt;/groupId&gt;
    &lt;artifactId&gt;google-api-services-androidpublisher&lt;/artifactId&gt;
    &lt;version&gt;v3-rev20211125-1.32.1&lt;/version&gt;
&lt;/dependency&gt;</code></pre><p style="line-height: 2;"><span style="color: rgb(196, 29, 127); font-size: 14px; font-family: 华文楷体;">这里介绍一下如何查找maven依赖的版本：</span></p><ul><li style="line-height: 2;"><span style="color: rgb(196, 29, 127); font-size: 14px; font-family: 华文楷体;">简单的方法：直接在在该网址上查询即可 </span><a href="https://mvnrepository.com/" target="_blank"><span style="font-size: 14px; font-family: 华文楷体;">https://mvnrepository.com/</span></a><span style="font-size: 14px; font-family: 华文楷体;"> ，不过版本可能不是最新，选择一个使用最多的版本即可</span></li><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">稍微复杂一点（正式一点），访问开发者后台</span><a href="https://console.cloud.google.com" target="_blank"><span style="font-size: 14px; font-family: 华文楷体;">https://console.cloud.google.com</span></a><span style="font-size: 14px; font-family: 华文楷体;">，右侧导航栏API和服务-&gt;库，搜索androidpublisher，进入api库里面，查看教程和文档，链接跳转到官方文档中，在使用入门最下面客户端库，</span><span style="color: rgb(32, 33, 36); background-color: rgb(255, 255, 255); font-size: 14px; font-family: 华文楷体;">请参阅</span><a href="https://developers.google.com/android-publisher/libraries?hl=zh-cn" target="" style="text-align: start;"><span style="font-size: 14px; font-family: 华文楷体;">客户端库和代码示例 </span></a><span style="color: rgb(32, 33, 36); background-color: rgb(255, 255, 255); font-size: 14px; font-family: 华文楷体;">点解链接进入</span><a href="https://developers.google.com/api-client-library/java/apis/androidpublisher/v3?hl=zh-cn" target=""><span style="font-size: 14px; font-family: 华文楷体;">适用于 Java 的 Google API 客户端库 </span></a><span style="font-size: 14px; font-family: 华文楷体;">即可跳转到官方的git仓库 </span><a href="https://github.com/googleapis/google-api-java-client-services/tree/main/clients/google-api-services-androidpublisher/v3" target="_blank"><span style="font-size: 14px; font-family: 华文楷体;">https://github.com/googleapis/google-api-java-client-services/tree/main/clients/google-api-services-androidpublisher/v3</span></a><span style="font-size: 14px; font-family: 华文楷体;"> </span></li></ul><p style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">上面这个过程有点复杂，不过记录一下下次自己找东西就方便多了，外文文档一不留神就不清楚到哪去找东西了</span></p><p style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">接下来先获取凭证：</span><span style="color: rgb(225, 60, 57); font-size: 14px; font-family: 华文楷体;">之前的GoogleCredential也会在后续被废弃，所以还是要能找到最新的文档</span></p><ul><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">在刚才（进入api库里面，查看教程和文档，链接跳转到</span><span style="color: rgb(130, 0, 20); font-size: 14px; font-family: 华文楷体;">官方文档</span><span style="font-size: 14px; font-family: 华文楷体;">中）这一步中选择左侧导航栏：</span><span style="color: rgb(130, 0, 20); font-size: 14px; font-family: 华文楷体;">使用入门</span></li><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">本页内容中：</span><span style="color: rgb(130, 0, 20); font-size: 14px; font-family: 华文楷体;">使用 OAuth 客户端，点击链接OAuth，进入到</span><span style="color: rgb(32, 33, 36); background-color: rgb(255, 255, 255); font-size: 14px; font-family: 华文楷体;">使用 OAuth 2.0 访问 Google API</span></li><li style="line-height: 2;"><span style="color: rgb(32, 33, 36); background-color: rgb(255, 255, 255); font-size: 14px; font-family: 华文楷体;">本页内容最下面：客户端库--</span><a href="https://developers.google.com/api-client-library/java/google-api-java-client/oauth2?hl=zh-cn" target=""><span style="font-size: 14px; font-family: 华文楷体;">适用于 Java 的 Google API 客户端库</span></a><span style="font-size: 14px; font-family: 华文楷体;">点击进入</span></li><li style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">本页内容中：服务账号：官方给的示例代码，修改获得自己的代码</span></li></ul><p style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">直接使用文档中的代码，发现还需要导入很多的包，这些包去哪找？</span></p><p style="text-indent: 2em; line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">在我们的文档页面最上面概览中介绍：</span><span style="color: rgb(32, 33, 36); background-color: rgb(255, 255, 255); font-size: 14px; font-family: 华文楷体;"><strong>目的</strong></span><span style="color: rgb(32, 33, 36); background-color: rgb(255, 255, 255); font-size: 14px; font-family: 华文楷体;">：本文档介绍了如何使用 </span><a href="https://googleapis.dev/java/google-api-client/latest/com/google/api/client/googleapis/auth/oauth2/GoogleCredential.html" target="" style="text-align: start;"><span style="font-size: 14px; font-family: 华文楷体;">GoogleCredential</span></a><span style="color: rgb(32, 33, 36); background-color: rgb(255, 255, 255); font-size: 14px; font-family: 华文楷体;"> 实用程序类对 Google 服务进行 OAuth 2.0 授权。如需了解我们提供的通用 OAuth 2.0 函数，请参阅 </span><a href="https://developers.google.com/api-client-library/java/google-oauth-java-client/oauth2?hl=zh-cn" target="" style="text-align: start;"><span style="font-size: 14px; font-family: 华文楷体;">OAuth 2.0 和 Java 版 Google OAuth 客户端库</span></a><span style="color: rgb(32, 33, 36); background-color: rgb(255, 255, 255); font-size: 14px; font-family: 华文楷体;">。</span></p><p style="line-height: 2;"><span style="color: rgb(225, 60, 57); background-color: rgb(255, 255, 255); font-size: 14px; font-family: 华文楷体;">我们需要到 </span><a href="https://developers.google.com/api-client-library/java/google-oauth-java-client/oauth2?hl=zh-cn" target="" style="text-align: start;"><span style="color: rgb(225, 60, 57); font-size: 14px; font-family: 华文楷体;">OAuth 2.0 和 Java 版 Google OAuth 客户端库这里面找</span></a><span style="font-size: 14px; font-family: 华文楷体;">里面有个</span><a href="https://developers.google.com/api-client-library/java/google-oauth-java-client/reference/1.20.0/com/google/api/client/auth/oauth2/package-summary.html?hl=zh-cn" target=""><span style="font-size: 14px; font-family: 华文楷体;">com.google.api.client.auth.oauth2</span></a><span style="font-size: 14px; font-family: 华文楷体;">（来自 </span><a href="https://developers.google.com/api-client-library/java/google-oauth-java-client/setup?hl=zh-cn#google-oauth-client" target=""><span style="font-size: 14px; font-family: 华文楷体;">google-oauth-client</span></a><span style="font-size: 14px; font-family: 华文楷体;">）</span></p><p style="line-height: 2;"><span style="font-size: 14px; font-family: 华文楷体;">点击进入 </span><a href="https://developers.google.com/api-client-library/java/google-oauth-java-client/setup?hl=zh-cn#google-oauth-client" target=""><span style="font-size: 14px; font-family: 华文楷体;">google-oauth-client</span></a><span style="font-size: 14px; font-family: 华文楷体;">使用到了里面的这些依赖</span></p><pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;com.google.oauth-client&lt;/groupId&gt;
    &lt;artifactId&gt;google-oauth-client&lt;/artifactId&gt;
    &lt;version&gt;1.30.4&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.google.oauth-client&lt;/groupId&gt;
    &lt;artifactId&gt;google-oauth-client-java6&lt;/artifactId&gt;
    &lt;version&gt;1.30.4&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.google.oauth-client&lt;/groupId&gt;
    &lt;artifactId&gt;google-oauth-client-jetty&lt;/artifactId&gt;
    &lt;version&gt;1.30.4&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--这个依赖文档中没有，不过确实用到了，我在其他文档中看到google-api-client-jackson2的2.0.0版本，不过那个有问题，所以还是按这个用吧 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.google.api-client&lt;/groupId&gt;
    &lt;artifactId&gt;google-api-client-jackson2&lt;/artifactId&gt;
    &lt;version&gt;1.30.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre><p><br></p>